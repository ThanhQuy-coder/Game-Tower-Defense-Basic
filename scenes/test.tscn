[gd_scene load_steps=3 format=3 uid="uid://b05iq5ro64lm8"]

[ext_resource type="PackedScene" uid="uid://ca0wcj4feyhui" path="res://scenes/ui/hud.tscn" id="2_bl13t"]

[sub_resource type="CSharpScript" id="CSharpScript_errlg"]
script/source = "using Godot;

public partial class TestNguoi3 : Node2D
{
	// UI Test buttons
	private Button _addGoldButton;
	private Button _spendGoldButton;
	private Button _damageButton;
	private Button _placeTowerButton;
	private Label _testInfoLabel;
	
	// Test tower (temporary visual)
	private Sprite2D _testTower;
	
	// Called when the node enters the scene tree for the first time
	public override void _Ready()
	{
		GD.Print(\"=== TEST NGƯỜI 3 - HỆ THỐNG & ĐIỀU KHIỂN ===\");
		GD.Print($\"Global Instance: {Global.Instance}\");
		GD.Print($\"Initial Gold: {Global.Instance.Gold}\");
		GD.Print($\"Initial Health: {Global.Instance.Health}\");
		
		// Create test UI
		CreateTestUI();
		
		// Create a simple test tower for visualization
		CreateTestTower();
	}
	
	// Create test UI buttons
	private void CreateTestUI()
	{
		// Create a control container for test buttons
		Control testPanel = new Control();
		testPanel.Name = \"TestPanel\";
		testPanel.Position = new Vector2(20, 100);
		AddChild(testPanel);
		
		// Add Gold Button
		_addGoldButton = new Button();
		_addGoldButton.Text = \"+10 Gold\";
		_addGoldButton.Position = new Vector2(0, 0);
		_addGoldButton.Size = new Vector2(150, 40);
		_addGoldButton.Pressed += OnAddGoldPressed;
		testPanel.AddChild(_addGoldButton);
		
		// Spend Gold Button
		_spendGoldButton = new Button();
		_spendGoldButton.Text = \"-10 Gold\";
		_spendGoldButton.Position = new Vector2(160, 0);
		_spendGoldButton.Size = new Vector2(150, 40);
		_spendGoldButton.Pressed += OnSpendGoldPressed;
		testPanel.AddChild(_spendGoldButton);
		
		// Take Damage Button
		_damageButton = new Button();
		_damageButton.Text = \"-1 Health\";
		_damageButton.Position = new Vector2(320, 0);
		_damageButton.Size = new Vector2(150, 40);
		_damageButton.Pressed += OnDamagePressed;
		testPanel.AddChild(_damageButton);
		
		// Place Tower Button (simulate click)
		_placeTowerButton = new Button();
		_placeTowerButton.Text = \"Place Tower (-50G)\";
		_placeTowerButton.Position = new Vector2(480, 0);
		_placeTowerButton.Size = new Vector2(150, 40);
		_placeTowerButton.Pressed += OnPlaceTowerPressed;
		testPanel.AddChild(_placeTowerButton);
		
		// Test Info Label
		_testInfoLabel = new Label();
		_testInfoLabel.Text = \"Click buttons to test. HUD should update automatically.\";
		_testInfoLabel.Position = new Vector2(0, 50);
		_testInfoLabel.Size = new Vector2(600, 30);
		testPanel.AddChild(_testInfoLabel);
	}
	
	// Create a simple test tower for visualization
	private void CreateTestTower()
	{
		// Create a simple tower sprite
		_testTower = new Sprite2D();
		_testTower.Texture = GD.Load<Texture2D>(\"res://icon.svg\"); // Use project icon
		_testTower.Scale = new Vector2(0.3f, 0.3f);
		_testTower.Position = new Vector2(400, 300);
		_testTower.Modulate = new Color(0, 1, 0); // Green color
		AddChild(_testTower);
		_testTower.Visible = false;
	}
	
	// Button handlers
	private void OnAddGoldPressed()
	{
		Global.Instance.AddGold(10);
		GD.Print($\"Gold +10. Total: {Global.Instance.Gold}\");
		_testInfoLabel.Text = $\"Added 10 Gold! Total: {Global.Instance.Gold}\";
	}
	
	private void OnSpendGoldPressed()
	{
		bool success = Global.Instance.SpendGold(10);
		if (success)
		{
			GD.Print($\"Gold -10. Total: {Global.Instance.Gold}\");
			_testInfoLabel.Text = $\"Spent 10 Gold! Total: {Global.Instance.Gold}\";
		}
		else
		{
			GD.Print($\"Cannot spend 10 Gold! Only have: {Global.Instance.Gold}\");
			_testInfoLabel.Text = $\"Not enough Gold! Have: {Global.Instance.Gold}\";
		}
	}
	
	private void OnDamagePressed()
	{
		Global.Instance.TakeDamage(1);
		GD.Print($\"Health -1. Total: {Global.Instance.Health}\");
		_testInfoLabel.Text = $\"Took 1 Damage! Health: {Global.Instance.Health}\";
	}
	
	private void OnPlaceTowerPressed()
	{
		if (Global.Instance.SpendGold(50))
		{
			GD.Print($\"Tower placed! Gold: {Global.Instance.Gold}\");
			_testInfoLabel.Text = $\"Tower placed! Gold: {Global.Instance.Gold}\";
			
			// Show visual feedback
			ShowTowerPlacement();
		}
		else
		{
			GD.Print($\"Not enough gold for tower! Need 50, have {Global.Instance.Gold}\");
			_testInfoLabel.Text = $\"Need 50 Gold! Have: {Global.Instance.Gold}\";
		}
	}
	
	// Visual feedback for tower placement
	private void ShowTowerPlacement()
	{
		// Make tower visible briefly
		_testTower.Visible = true;
		_testTower.Modulate = new Color(1, 1, 1); // White color
		
		// Create timer to hide it
		Timer timer = new Timer();
		timer.WaitTime = 0.5f;
		timer.OneShot = true;
		timer.Timeout += () => {
			_testTower.Visible = false;
			_testTower.Modulate = new Color(0, 1, 0); // Back to green
			timer.QueueFree();
		};
		AddChild(timer);
		timer.Start();
	}
	
	// Display debug info
	public override void _Process(double delta)
	{
		// Update debug info (optional)
	}
}
"

[node name="Node2D" type="Node2D"]
script = SubResource("CSharpScript_errlg")

[node name="hud" parent="." instance=ExtResource("2_bl13t")]
